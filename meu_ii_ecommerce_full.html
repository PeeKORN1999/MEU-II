<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MEU-II Marketplace (meu-ii)</title>
  <style>
    :root{
      --bg:#ffffff; --fg:#000000; --accent:#000;
    }
    html,body{height:100%;margin:0;font-family:Inter, Roboto, system-ui, "TH Sarabun New", sans-serif;background:var(--bg);color:var(--fg)}
    header{display:flex;align-items:center;justify-content:space-between;padding:12px 18px;border-bottom:1px solid #eee;position:sticky;top:0;background:rgba(255,255,255,0.9);backdrop-filter:blur(6px);z-index:50}
    .brand{display:flex;align-items:center;gap:10px}
    .brand img.logo{width:110px;height:50px;object-fit:contain}
    nav .menu{display:flex;gap:10px;align-items:center}
    .menu button{background:none;border:none;padding:8px 12px;border-radius:8px;cursor:pointer}
    .lang-switch{position:relative}
    .lang-layer{position:absolute;top:calc(100% + 6px);right:0;background:#fff;border:1px solid #ddd;padding:6px;border-radius:8px;display:none;box-shadow:0 8px 20px rgba(0,0,0,0.08)}
    .lang-layer button{display:flex;align-items:center;gap:8px;padding:6px;border-radius:6px;border:none;background:none;cursor:pointer}
    main{padding:18px}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:16px}
    .card{border:1px solid #eee;padding:10px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.6), rgba(255,255,255,0.9))}
    .card img{width:100%;height:160px;object-fit:cover;border-radius:8px}
    .price{font-weight:700}
    .topbar-right{display:flex;gap:12px;align-items:center}
    .icon-btn{background:#000;color:#fff;border:none;padding:8px;border-radius:50%;width:38px;height:38px;display:inline-grid;place-items:center;cursor:pointer}
    .floating{position:fixed;right:18px;bottom:18px;z-index:60;display:flex;flex-direction:column;gap:10px}
    .float-btn{width:56px;height:56px;border-radius:50%;display:grid;place-items:center;background:var(--accent);color:#fff;box-shadow:0 6px 18px rgba(0,0,0,0.15);cursor:pointer}
    .mini-sticker{position:fixed;left:20px;bottom:120px;width:80px;height:80px;border-radius:18px;display:grid;place-items:center;font-weight:700;cursor:pointer;z-index:40}
    .sticker-sprite{position:fixed;z-index:30;pointer-events:auto}
    .search-input{border:1px solid #ddd;padding:8px 12px;border-radius:999px;width:220px}
    footer{padding:20px;border-top:1px solid #eee;text-align:center;margin-top:40px}
    .admin-panel{position:fixed;right:0;top:0;height:100%;width:420px;background:#fff;border-left:1px solid #ddd;transform:translateX(100%);transition:transform .25s;z-index:80;overflow:auto;padding:12px}
    .admin-panel.open{transform:translateX(0)}
    .modal{position:fixed;inset:0;background:rgba(0,0,0,0.45);display:none;place-items:center;z-index:90}
    .modal.open{display:grid}
    .card-actions{display:flex;gap:8px;margin-top:8px}
    .tag{display:inline-block;padding:4px 8px;border-radius:8px;border:1px dashed #bbb;margin-right:6px}
    .ticker{white-space:nowrap;overflow:hidden}
    .ticker span{display:inline-block;padding-left:100%;animation:marquee 12s linear infinite}
    @keyframes marquee{from{transform:translateX(0)}to{transform:translateX(-100%)}}
    .video-bg{position:fixed;inset:0;z-index:-1;object-fit:cover;width:100%;height:100%;opacity:.12}
    .badge{background:var(--accent);color:#fff;padding:4px 8px;border-radius:8px;font-size:12px}
    /* responsive */
    @media(max-width:800px){.search-input{width:120px}.brand img.logo{width:90px}}
  </style>
</head>
<body>
  <!-- Background video placeholder -->
  <video id="bgVideo" class="video-bg" autoplay muted loop style="display:none"></video>

  <header>
    <div class="brand">
      <img id="siteLogo" class="logo" src="/assets/logo.png" alt="MEU-II Logo">
      <div>
        <div style="font-weight:800">MEU-II</div>
        <div style="font-size:12px;color:#666">meu-ii (link: /meu-ii)</div>
      </div>
    </div>

    <div class="menu">
      <div class="ticker" style="max-width:320px"><span id="announcementText">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà MEU-II - ‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ! ‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏û‡∏£‡∏µ‡πÄ‡∏°‡∏µ‡πà‡∏¢‡∏°</span></div>
      <button onclick="openPage('home')">‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</button>
      <button onclick="openPage('about')">‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö</button>
      <button onclick="openPage('contact')">‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏£‡∏≤</button>
      <button onclick="openPage('events')">‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</button>
      <button onclick="openPage('notice')">‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®</button>
      <button onclick="openPage('account')">‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</button>
    </div>

    <div class="topbar-right">
      <input id="search" class="search-input" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤: ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤, ‡∏´‡∏°‡∏ß‡∏î, ‡∏£‡∏≤‡∏Ñ‡∏≤" />
      <div class="lang-switch">
        <button id="langBtn" class="icon-btn">üåê</button>
        <div id="langLayer" class="lang-layer">
          <button data-lang="th">üáπüá≠ ‡πÑ‡∏ó‡∏¢</button>
          <button data-lang="en">üá¨üáß English</button>
          <button data-lang="zh">üá®üá≥ ‰∏≠Êñá</button>
        </div>
      </div>
      <button id="cartBtn" class="icon-btn">üõí<span id="cartCount" style="font-size:11px;margin-left:6px">0</span></button>
      <button id="loginBtn" class="icon-btn">üë§</button>
    </div>
  </header>

  <!-- Admin panel (right) -->
  <aside id="adminPanel" class="admin-panel" aria-hidden>
    <h3>‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô (Admin)</h3>
    <div style="margin-bottom:8px">‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏• (‡∏ó‡∏î‡∏•‡∏≠‡∏á): <input id="adminPass" type="password"><button id="adminLogin">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button></div>
    <div id="adminArea" style="display:none">
      <h4>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h4>
      <div>
        <input id="pName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤"/><br/>
        <input id="pPrice" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤" type="number"/><br/>
        <input id="pCategory" placeholder="‡∏´‡∏°‡∏ß‡∏î"/><br/>
        <input id="pImage" type="file" accept="image/*"/><br/>
        <button id="addProduct">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
      </div>
      <h4>‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á</h4>
      <div>
        <input id="couponCode" placeholder="CODE"/><input id="couponPercent" placeholder="‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î %" type="number"/><button id="addCoupon">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á</button>
      </div>
      <h4>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÇ‡∏•‡πÇ‡∏Å‡πâ</h4>
      <input id="logoUpload" type="file" accept="image/*"/><br/>
      <h4>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡πâ‡∏≤‡∏ô</h4>
      <textarea id="shopSettings" rows="4" style="width:100%"></textarea>
      <h4>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô/‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á)</h4>
      <div id="stats"></div>
    </div>
  </aside>

  <div id="modal" class="modal"><div style="background:#fff;padding:18px;border-radius:10px;min-width:320px;max-width:92vw" id="modalContent"></div></div>

  <main id="app">
    <section id="home" class="page">
      <h2>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h2>
      <div style="margin-bottom:12px">
        <select id="sortSelect"><option value="new">‡πÉ‡∏´‡∏°‡πà‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</option><option value="priceAsc">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≥ ‚Üí ‡∏™‡∏π‡∏á</option><option value="priceDesc">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏π‡∏á ‚Üí ‡∏ï‡πà‡∏≥</option></select>
        <button onclick="openAdmin()">‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô</button>
      </div>
      <div id="productGrid" class="grid"></div>
    </section>

    <section id="about" class="page" style="display:none">
      <h2>‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö</h2>
      <p>MEU-II ‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏û‡∏•‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô</p>
    </section>

    <section id="contact" class="page" style="display:none">
      <h2>‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏£‡∏≤</h2>
      <p>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà: <span id="addressText">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Å‡∏≥‡∏´‡∏ô‡∏î</span></p>
    </section>

    <section id="events" class="page" style="display:none">
      <h2>‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</h2>
    </section>

    <section id="notice" class="page" style="display:none">
      <h2>‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®</h2>
    </section>

    <section id="account" class="page" style="display:none">
      <h2>‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</h2>
      <div id="authArea">
        <button id="regGoogle">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏î‡πâ‡∏ß‡∏¢ Google (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á)</button>
        <div style="margin-top:8px">‡∏´‡∏£‡∏∑‡∏≠ ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</div>
        <input id="regPhone" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£"/><button id="regPhoneBtn">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</button>
      </div>
      <div id="accountInfo" style="display:none">
        <p>‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ, <span id="accName"></span></p>
        <div>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà: <button id="addAddress">‡πÄ‡∏û‡∏¥‡πà‡∏°/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</button></div>
      </div>
    </section>
  </main>

  <div class="floating">
    <div class="float-btn" id="serviceBtn" title="‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ù‡πà‡∏≤‡∏¢‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£">üí¨</div>
    <div class="float-btn" id="codeBtn" title="‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î">üéüÔ∏è</div>
  </div>

  <div class="mini-sticker" id="sticker" style="background:linear-gradient(45deg,#ffb347,#ffcc33);">
    <img src="/assets/logo.png" style="width:56px;height:56px;object-fit:contain;pointer-events:none" alt="MEU-II">
  </div>

  <footer>
    <div>¬© <span id="year"></span> MEU-II. ‡∏™‡∏á‡∏ß‡∏ô‡∏•‡∏¥‡∏Ç‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå</div>
    <div style="margin-top:6px">‡πÄ‡∏ß‡∏•‡∏≤‡πÑ‡∏ó‡∏¢: <span id="thaiTime"></span> <span id="tzFlag"></span></div>
  </footer>

  <script>
    // Basic data storage (localStorage) to simulate backend
    const STORAGE_PRODUCTS = 'meu_products_v1';
    const STORAGE_CART = 'meu_cart_v1';
    const STORAGE_COUPONS = 'meu_coupons_v1';
    const STORAGE_USERS = 'meu_users_v1';

    // demo initial products
    const demoProducts = [
      {id:1,name:{th:'‡∏£‡∏≠‡∏á‡πÄ‡∏ó‡πâ‡∏≤‡∏ß‡∏¥‡πà‡∏á',en:'Running Shoes',zh:'Ë∑ëÊ≠•Èûã'},price:1290,category:'‡∏£‡∏≠‡∏á‡πÄ‡∏ó‡πâ‡∏≤',img:'https://picsum.photos/400?random=11'},
      {id:2,name:{th:'‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏¢‡∏∑‡∏î',en:'T-Shirt',zh:'TÊÅ§'},price:299,category:'‡πÄ‡∏™‡∏∑‡πâ‡∏≠',img:'https://picsum.photos/400?random=12'},
      {id:3,name:{th:'‡∏´‡∏π‡∏ü‡∏±‡∏á',en:'Headphones',zh:'ËÄ≥Êú∫'},price:1590,category:'‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå',img:'https://picsum.photos/400?random=13'},
    ];

    // init
    function init(){
      if(!localStorage.getItem(STORAGE_PRODUCTS)) localStorage.setItem(STORAGE_PRODUCTS,JSON.stringify(demoProducts));
      if(!localStorage.getItem(STORAGE_COUPONS)) localStorage.setItem(STORAGE_COUPONS,JSON.stringify([]));
      renderProducts();
      document.getElementById('year').textContent = new Date().toLocaleString('th-TH',{year:'numeric'});
      updateThaiTime(); setInterval(updateThaiTime,1000);
      // lang switcher
      const langBtn = document.getElementById('langBtn'); const langLayer=document.getElementById('langLayer');
      langBtn.addEventListener('click',()=>{langLayer.style.display = langLayer.style.display==='block'?'none':'block'})
      langLayer.querySelectorAll('button').forEach(b=>b.addEventListener('click',()=>{setLang(b.dataset.lang);langLayer.style.display='none'}))
      // cart
      document.getElementById('cartBtn').addEventListener('click',openCart);
      loadCartCount();
      // sticker behaviour
      const sticker = document.getElementById('sticker'); sticker.addEventListener('click',()=>{window.open('https://line.me/ti/p/~@727kpgao','_blank')});
      // service floating
      document.getElementById('serviceBtn').addEventListener('click',()=>{window.open('https://line.me/ti/p/~@727kpgao','_blank')});
      document.getElementById('codeBtn').addEventListener('click',()=>{alert('‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏î‡∏•‡∏≠‡∏á: WELCOME10')});
      // admin login
      document.getElementById('adminLogin').addEventListener('click',()=>{if(document.getElementById('adminPass').value==='admin123'){document.getElementById('adminArea').style.display='block';saveStats();renderProducts();alert('‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢')}})
      document.getElementById('addProduct').addEventListener('click',handleAddProduct);
      document.getElementById('logoUpload').addEventListener('change',handleLogoUpload);
      document.getElementById('pImage').addEventListener('change',handleNewProductImage);
      document.getElementById('addCoupon').addEventListener('click',addCoupon);
      document.getElementById('regPhoneBtn').addEventListener('click',registerPhone);
      document.getElementById('loginBtn').addEventListener('click',()=>{openPage('account')});
      document.getElementById('search').addEventListener('keyup',searchNow);
      document.getElementById('sortSelect').addEventListener('change',renderProducts);
      // admin open
      document.getElementById('adminPass').addEventListener('keyup',(e)=>{if(e.key==='Enter')document.getElementById('adminLogin').click()});
      // open admin panel by button
      window.openAdmin = openAdmin;
      // load site settings
      const settings = localStorage.getItem('meu_settings'); if(settings){document.getElementById('addressText').textContent = JSON.parse(settings).address||'‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Å‡∏≥‡∏´‡∏ô‡∏î'}
      // stickers animation
      animateSticker();
      // load logo
      const logoData = localStorage.getItem('meu_logo'); if(logoData) document.getElementById('siteLogo').src = logoData;
    }

    function saveStats(){
      const statsEl = document.getElementById('stats');
      const products = JSON.parse(localStorage.getItem(STORAGE_PRODUCTS)||'[]');
      const cart = JSON.parse(localStorage.getItem(STORAGE_CART)||'[]');
      statsEl.innerHTML = `<div>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤: ${products.length}</div><div>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤: ${cart.length}</div>`;
    }

    function renderProducts(){
      const grid = document.getElementById('productGrid'); grid.innerHTML='';
      let products = JSON.parse(localStorage.getItem(STORAGE_PRODUCTS)||'[]');
      const sort = document.getElementById('sortSelect').value;
      if(sort==='priceAsc') products.sort((a,b)=>a.price-b.price);
      if(sort==='priceDesc') products.sort((a,b)=>b.price-a.price);
      products.forEach(p=>{
        const div = document.createElement('div'); div.className='card';
        div.innerHTML = `<img src="${p.img}" alt="${p.name?.th||p.name}"><h3>\${p.name?.th||p.name}</h3><div class='price'>‡∏ø\${p.price}</div><div class='card-actions'><button onclick='addToCart(${p.id})'>‡πÉ‡∏™‡πà‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</button><button onclick='openProduct(${p.id})'>‡∏î‡∏π‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button></div>`;
        grid.appendChild(div);
      })
      saveStats();
    }

    function openProduct(id){
      const products = JSON.parse(localStorage.getItem(STORAGE_PRODUCTS)||'[]'); const p = products.find(x=>x.id===id);
      if(!p) return alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤');
      document.getElementById('modalContent').innerHTML = `<h3>\${p.name?.th||p.name}</h3><img src='\${p.img}' style='width:100%;height:240px;object-fit:cover;border-radius:8px'><p>‡∏£‡∏≤‡∏Ñ‡∏≤: ‡∏ø\${p.price}</p><p>‡∏´‡∏°‡∏ß‡∏î: \${p.category}</p><div><button onclick='addToCart(\${p.id});closeModal()'>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</button> <button onclick='closeModal()'>‡∏õ‡∏¥‡∏î</button></div>`;
      openModal();
    }

    function openModal(){document.getElementById('modal').classList.add('open')}
    function closeModal(){document.getElementById('modal').classList.remove('open')}
    document.getElementById('modal').addEventListener('click',(e)=>{if(e.target.id==='modal')closeModal()});

    function addToCart(id){
      const cart = JSON.parse(localStorage.getItem(STORAGE_CART)||'[]');
      cart.push({id,qty:1}); localStorage.setItem(STORAGE_CART,JSON.stringify(cart)); loadCartCount(); alert('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß');
    }
    function loadCartCount(){const c = JSON.parse(localStorage.getItem(STORAGE_CART)||'[]'); document.getElementById('cartCount').textContent = c.length}

    function openCart(){
      const cart = JSON.parse(localStorage.getItem(STORAGE_CART)||'[]');
      const products = JSON.parse(localStorage.getItem(STORAGE_PRODUCTS)||'[]');
      let html = '<h3>‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3>';
      if(cart.length===0) html += '<p>‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏ß‡πà‡∏≤‡∏á</p>'
      else{
        let total=0; html += '<ul>';
        cart.forEach((c,i)=>{const p = products.find(x=>x.id===c.id); if(p){total+=p.price*c.qty; html+=`<li>\${p.name?.th||p.name} x\${c.qty} - ‡∏ø\${p.price*c.qty} <button onclick="removeCart(\${i})">‡∏•‡∏ö</button></li>`}});
        html += `</ul><div>‡∏£‡∏ß‡∏°: ‡∏ø\${total}</div><div style='margin-top:8px'><button onclick='checkout()'>‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</button></div>`;
      }
      document.getElementById('modalContent').innerHTML = html; openModal();
    }
    function removeCart(index){const cart=JSON.parse(localStorage.getItem(STORAGE_CART)||'[]');cart.splice(index,1);localStorage.setItem(STORAGE_CART,JSON.stringify(cart));openCart();loadCartCount()}

    function checkout(){
      // Simulate payment options modal
      document.getElementById('modalContent').innerHTML = `<h3>‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h3><p>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞ (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á)</p><button onclick='payBank()'>‡πÇ‡∏≠‡∏ô‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£</button> <button onclick='payQR()'>‡∏™‡πÅ‡∏Å‡∏ô QR (‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏û‡∏¢‡πå)</button> <button onclick='closeModal()'>‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>`;
      openModal();
    }
    function payBank(){document.getElementById('modalContent').innerHTML = `<h3>‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</h3><p>‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£: ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á</p><p>‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ç‡∏ä‡∏µ: 0123456789</p><p>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô: ...</p><div><button onclick='confirmPaid()'>‡πÅ‡∏à‡πâ‡∏á‡∏ä‡∏≥‡∏£‡∏∞</button></div>`}
    function payQR(){document.getElementById('modalContent').innerHTML = `<h3>‡∏™‡πÅ‡∏Å‡∏ô QR ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏û‡∏¢‡πå</h3><p><img src='https://dummyimage.com/300x300/eee/000&text=QR+Placeholder'></p><div><button onclick='confirmPaid()'>‡πÅ‡∏à‡πâ‡∏á‡∏ä‡∏≥‡∏£‡∏∞</button></div>`}
    function confirmPaid(){alert('‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏≠‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏≠‡∏£‡πå (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á)'); localStorage.setItem(STORAGE_CART,JSON.stringify([])); loadCartCount(); closeModal();}

    // Admin product add with image to base64
    let newProductImageData='';
    function handleNewProductImage(e){const f=e.target.files[0]; if(!f) return; const r=new FileReader(); r.onload=function(){newProductImageData=r.result}; r.readAsDataURL(f)}
    function handleAddProduct(){const name=document.getElementById('pName').value; const price=Number(document.getElementById('pPrice').value); const cat=document.getElementById('pCategory').value; if(!name||!price) return alert('‡∏Å‡∏£‡∏≠‡∏Å‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö'); let products=JSON.parse(localStorage.getItem(STORAGE_PRODUCTS)||'[]'); const id=Date.now(); products.push({id,name:{th:name,en:name,zh:name},price,category:cat,img:newProductImageData||'https://picsum.photos/400?random='+Math.floor(Math.random()*1000)}); localStorage.setItem(STORAGE_PRODUCTS,JSON.stringify(products)); renderProducts(); alert('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß')}

    // Logo upload
    function handleLogoUpload(e){const f=e.target.files[0]; if(!f) return; const r=new FileReader(); r.onload=function(){localStorage.setItem('meu_logo',r.result); document.getElementById('siteLogo').src=r.result; alert('‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢')}; r.readAsDataURL(f)}

    // Coupons
    function addCoupon(){const code=document.getElementById('couponCode').value; const pct=Number(document.getElementById('couponPercent').value); if(!code) return alert('‡πÉ‡∏™‡πà‡πÇ‡∏Ñ‡πâ‡∏î'); let coupons=JSON.parse(localStorage.getItem(STORAGE_COUPONS)||'[]'); coupons.push({code,percent:pct}); localStorage.setItem(STORAGE_COUPONS,JSON.stringify(coupons)); alert('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß')}

    // Registration (phone) local only; enforces one phone, one email per localStorage
    function registerPhone(){const phone=document.getElementById('regPhone').value.trim(); if(!phone) return alert('‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå'); let users=JSON.parse(localStorage.getItem(STORAGE_USERS)||'[]'); if(users.find(u=>u.phone===phone)) return alert('‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡πâ‡∏ß'); users.push({id:Date.now(),phone}); localStorage.setItem(STORAGE_USERS,JSON.stringify(users)); alert('‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢'); document.getElementById('accName').textContent=phone; document.getElementById('accountInfo').style.display='block';}

    // Language switch and auto currency/labels
    let LANG = localStorage.getItem('meu_lang')||'th';
    function setLang(l){LANG=l; localStorage.setItem('meu_lang',l); applyLang();}
    function applyLang(){ // Minimal translations for demo
      const map = {
        th:{cart:'‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤',account:'‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô'},
        en:{cart:'Cart',account:'My Account'},
        zh:{cart:'Ë¥≠Áâ©ËΩ¶',account:'ÊàëÁöÑË¥¶Êà∑'}
      };
      document.getElementById('cartBtn').title = map[LANG].cart || 'Cart';
    }

    // page router
    function openPage(id){document.querySelectorAll('.page').forEach(p=>p.style.display='none');document.getElementById(id).style.display='block'}

    // small functions
    function updateThaiTime(){ const now = new Date(); document.getElementById('thaiTime').textContent = now.toLocaleString('th-TH',{hour:'2-digit',minute:'2-digit',second:'2-digit'}); document.getElementById('tzFlag').textContent='üáπüá≠'}

    function openAdmin(){document.getElementById('adminPanel').classList.toggle('open')}

    // search
    function searchNow(e){const q=e.target.value.trim().toLowerCase(); const products=JSON.parse(localStorage.getItem(STORAGE_PRODUCTS)||'[]'); const results=products.filter(p=> (p.name?.th||p.name).toLowerCase().includes(q) || (p.category||'').toLowerCase().includes(q) || String(p.price).includes(q)); const grid=document.getElementById('productGrid'); grid.innerHTML=''; results.forEach(p=>{const d=document.createElement('div');d.className='card';d.innerHTML=`<img src="${p.img}"><h3>${p.name?.th||p.name}</h3><div class='price'>‡∏ø${p.price}</div><div class='card-actions'><button onclick='addToCart(${p.id})'>‡πÉ‡∏™‡πà‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</button><button onclick='openProduct(${p.id})'>‡∏î‡∏π‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button></div>`;grid.appendChild(d)})}

    // sticker animation
    function animateSticker(){const s=document.getElementById('sticker'); let dir=1; let x=20,y=120, vx=1+Math.random()*2; setInterval(()=>{x+=vx*dir; if(x>window.innerWidth-120||x<10) dir*=-1; s.style.left = x+'px'; s.style.bottom = (100+20*Math.sin(Date.now()/400))+'px'},40)}

    // page init
    init();

    // Note: Many features below require server-side/backend & third-party APIs to be secure & reliable:
    // - Real payment gateway integrations for Thai banks & PromptPay (use providers like Omise, 2C2P, SCB Pay, PayNow etc.)
    // - Shipping API aggregation (Kerry, J&T, Flash, Thailand Post) require server keys & webhooks
    // - Real Google OAuth needs backend & client id / secret
    // - IP detection & fraud prevention requires server logging
    // - Multi-store marketplace logic (role-based accounts, payouts) requires DB and scheduled jobs
    // This single-file demo simulates UI, local persistence (localStorage) and admin editing. To make this production-ready, you will need a backend (Node/Express, PHP, Python/Django, or similar), a database (MySQL/Postgres/Mongo), and payment + shipping provider integrations.

  </script>
</body>
</html>
